<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>競馬資金配分ツール（18頭対応）</title>
    <style>
        .input-group {
            margin-bottom: 10px;
        }
        .odds-input {
            width: 8ch;
        }
        .result-text {
            display: inline-block;
            margin-left: 10px;
            min-width: 160px;
        }
    </style>
</head>
<body>
    <h1>競馬資金配分ツール（最大18頭）</h1>
    <p>各馬のオッズと総資金を入力して、賭け金額と払戻し金額を表示します。</p>

    <label for="totalAmount">総資金:</label>
    <input type="number" id="totalAmount" required>
    <button onclick="calculateBetting()">計算</button>
    <br><br>

    <div id="oddsContainer">
        <!-- 各馬のオッズ入力欄を生成 -->
    </div>

    <script>
        // 最大18頭分のオッズ入力欄を生成
        const maxHorses = 18;
        const oddsContainer = document.getElementById('oddsContainer');

        for (let i = 1; i <= maxHorses; i++) {
            const div = document.createElement('div');
            div.classList.add('input-group');

            const label = document.createElement('label');
            label.textContent = `馬${i}のオッズ: `;
            
            const input = document.createElement('input');
            input.type = 'number';
            input.step = '0.1';
            input.required = true;
            input.classList.add('odds-input');
            input.id = `odds${i}`;
            input.oninput = calculateBetting; // オッズ入力時に動的に更新

            const resultSpan = document.createElement('span');
            resultSpan.classList.add('result-text');
            resultSpan.id = `result${i}`;
            resultSpan.textContent = "賭け金額: - 円 / 払戻し金額: - 円";

            div.appendChild(label);
            div.appendChild(input);
            div.appendChild(resultSpan);
            oddsContainer.appendChild(div);
        }

        function calculateBetting() {
            const totalAmount = parseFloat(document.getElementById("totalAmount").value);

            if (isNaN(totalAmount)) {
                alert("総資金を入力してください。");
                return;
            }

            let oddsList = [];
            for (let i = 1; i <= maxHorses; i++) {
                const oddsValue = parseFloat(document.getElementById(`odds${i}`).value);
                if (!isNaN(oddsValue) && oddsValue > 0) {
                    oddsList.push({ horse: i, odds: oddsValue });
                }
            }

            // 入力された馬がいない場合
            if (oddsList.length === 0) {
                alert("最低1頭の馬のオッズを入力してください。");
                return;
            }

            let totalOddsSum = oddsList.reduce((sum, entry) => sum + (1 / entry.odds), 0);

            oddsList.forEach(entry => {
                const betAmount = Math.max(100, Math.floor((totalAmount / totalOddsSum) * (1 / entry.odds) / 100) * 100); // 100円単位
                const payoutAmount = betAmount * entry.odds;

                const resultSpan = document.getElementById(`result${entry.horse}`);
                resultSpan.textContent = `賭け金額: ${betAmount}円 / 払戻し金額: ${payoutAmount.toFixed(2)}円`;
            });

            // 入力がない馬の賭け金額と払戻し金額をリセット
            for (let i = 1; i <= maxHorses; i++) {
                if (!oddsList.some(entry => entry.horse === i)) {
                    document.getElementById(`result${i}`).textContent = "賭け金額: - 円 / 払戻し金額: - 円";
                }
            }
        }
    </script>
</body>
</html>
