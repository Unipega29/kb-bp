<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструменты для распределения средств</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS 1p', sans-serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        colgroup col:nth-child(2) {
            width: 40%;
        }
        th, td {
            text-align: center;
            padding: 8px;
            border: 1px solid white;
        }
        th {
            background-color: mediumaquamarine;
        }
        td {
            background-color: #bfefdf;
        }
        .number-col {
            background-color: mediumaquamarine;
        }
        #totalAmount, button {
            font-size: 1em;
            padding: 5px;
            margin-top: 10px;
        }
        .clear-btn {
            margin-top: 20px;
        }
        .total-bet {
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Инструменты для распределения средств</h1>

    <label for="totalAmount">Общие средства:</label>
    <input type="number" id="totalAmount" required>
    <button onclick="calculateBetting()">Рассчитать</button>
    <button onclick="pasteOdds()">Вставить</button>

    <div class="total-bet">
        <p>Общие ставки: <span id="totalBetAmount">0</span>円</p>
    </div>

    <table>
        <colgroup>
            <col>
            <col>
            <col>
            <col>
        </colgroup>
        <thead>
            <tr>
                <th>Номер</th>
                <th>Увел.</th>
                <th>Ставки</th>
                <th>Возврат</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- データ行を動的に生成 -->
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" style="text-align: center; font-weight: bold;">Общие ставки</td>
            </tr>
        </tfoot>
    </table>

    <button class="clear-btn" onclick="clearTable()">Очистить</button>

    <script>
        const maxHorses = 18;
        const tableBody = document.getElementById('tableBody');
        const distributionPercentages = [29.34, 21.03, 14.35, 11.83, 8.33, 5.63, 4.59, 3.31, 1.59];

        for (let i = 1; i <= maxHorses; i++) {
            const row = document.createElement('tr');

            const numberCell = document.createElement('td');
            numberCell.textContent = i;
            numberCell.classList.add('number-col');

            const oddsCell = document.createElement('td');
            const oddsInput = document.createElement('input');
            oddsInput.type = 'number';
            oddsInput.step = '0.1';
            oddsInput.id = `odds${i}`;
            oddsCell.appendChild(oddsInput);

            const betCell = document.createElement('td');
            betCell.id = `bet${i}`;
            betCell.textContent = "-";

            const payoutCell = document.createElement('td');
            payoutCell.id = `payout${i}`;
            payoutCell.textContent = "-";

            row.appendChild(numberCell);
            row.appendChild(oddsCell);
            row.appendChild(betCell);
            row.appendChild(payoutCell);
            tableBody.appendChild(row);
        }

        function calculateBetting() {
            const totalAmount = parseFloat(document.getElementById("totalAmount").value);

            if (isNaN(totalAmount)) {
                alert("Общие средстваを入力してください。");
                return;
            }

            let oddsList = [];
            for (let i = 1; i <= maxHorses; i++) {
                const oddsValue = parseFloat(document.getElementById(`odds${i}`).value);
                if (!isNaN(oddsValue) && oddsValue >= 4) {
                    oddsList.push({ horse: i, odds: oddsValue });
                }
            }

            let remainingAmount = totalAmount;
            let totalBetAmount = 0;

            oddsList.forEach(entry => {
                const targetPayout = totalAmount * 1.1;
                const minimumBetAmount = Math.max(100, Math.ceil(targetPayout / entry.odds / 100) * 100);
                const payoutAmount = Math.floor(minimumBetAmount * entry.odds);

                document.getElementById(`bet${entry.horse}`).textContent = minimumBetAmount.toLocaleString();
                document.getElementById(`payout${entry.horse}`).textContent = payoutAmount.toLocaleString();

                remainingAmount -= minimumBetAmount;
                totalBetAmount += minimumBetAmount;
            });

            let remainingPercentage = [...distributionPercentages];
            let remainingSum = remainingAmount;

            for (let i = 0; i < oddsList.length && i < distributionPercentages.length; i++) {
                const entry = oddsList[i];
                const additionalAmount = Math.floor((remainingSum * remainingPercentage[i]) / 100 / 100) * 100;
                const updatedBetAmount = parseFloat(document.getElementById(`bet${entry.horse}`).textContent.replace(/,/g, '')) + additionalAmount;

                document.getElementById(`bet${entry.horse}`).textContent = updatedBetAmount.toLocaleString();
                document.getElementById(`payout${entry.horse}`).textContent = Math.floor(updatedBetAmount * entry.odds).toLocaleString();

                totalBetAmount += additionalAmount;
            }

            // 資金が余った場合、オッズの上位から順に100円ずつ追加
            while (remainingAmount >= 100) {
                for (let entry of oddsList) {
                    if (remainingAmount < 100) break;

                    const currentBet = parseInt(document.getElementById(`bet${entry.horse}`).textContent.replace(/,/g, ''), 10);
                    document.getElementById(`bet${entry.horse}`).textContent = (currentBet + 100).toLocaleString();
                    document.getElementById(`payout${entry.horse}`).textContent = Math.floor((currentBet + 100) * entry.odds).toLocaleString();

                    totalBetAmount += 100;
                    remainingAmount -= 100;
                }
            }

            document.getElementById('totalBetAmount').textContent = totalBetAmount.toLocaleString();
        }

        function clearTable() {
            for (let i = 1; i <= maxHorses; i++) {
                document.getElementById(`odds${i}`).value = '';
                document.getElementById(`bet${i}`).textContent = "-";
                document.getElementById(`payout${i}`).textContent = "-";
            }
            document.getElementById('totalBetAmount').textContent = "0";
        }
    </script>
</body>
</html>
