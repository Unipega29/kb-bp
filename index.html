<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструменты для распределения средств</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS 1p', sans-serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: nowrap;
        }
        .odds-input {
            width: 6ch;
            margin-left: 10px;
        }
        .result-text {
            margin-left: 10px;
            min-width: 180px;
            white-space: nowrap;
        }
        #totalAmount, button {
            font-size: 1em;
            padding: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Инструменты для распределения средств</h1>
    <p></p>

    <label for="totalAmount">Общие средства:</label>
    <input type="number" id="totalAmount" required>
    <button onclick="calculateBetting()">Рассчитать</button>
    <br><br>

    <div id="oddsContainer">
        <!-- 入力欄を生成 -->
    </div>

    <script>
        // 最大18入力欄を生成
        const maxHorses = 18;
        const oddsContainer = document.getElementById('oddsContainer');

        for (let i = 1; i <= maxHorses; i++) {
            const div = document.createElement('div');
            div.classList.add('input-group');

            const label = document.createElement('label');
            label.textContent = ` ${i} `;
            
            const input = document.createElement('input');
            input.type = 'number';
            input.step = '0.1';
            input.required = true;
            input.classList.add('odds-input');
            input.id = `odds${i}`;
            input.onblur = () => validateOdds(input); // フォーカスが外れたときにチェック

            const resultSpan = document.createElement('span');
            resultSpan.classList.add('result-text');
            resultSpan.id = `result${i}`;
            resultSpan.textContent = "Колья: - / Возврат: -";

            div.appendChild(label);
            div.appendChild(input);
            div.appendChild(resultSpan);
            oddsContainer.appendChild(div);
        }

        // オッズの入力値をチェック
        function validateOdds(input) {
            const oddsValue = parseFloat(input.value);
            if (!isNaN(oddsValue) && oddsValue < 4) {
                alert("Введите минимум 4 !!!");
                input.value = ''; // エラー後にクリア
            }
        }

        function calculateBetting() {
            const totalAmount = parseFloat(document.getElementById("totalAmount").value);

            if (isNaN(totalAmount)) {
                alert("Введите общие средства");
                return;
            }

            let oddsList = [];
            for (let i = 1; i <= maxHorses; i++) {
                const oddsValue = parseFloat(document.getElementById(`odds${i}`).value);
                if (!isNaN(oddsValue) && oddsValue >= 4) {
                    oddsList.push({ horse: i, odds: oddsValue });
                }
            }

            let totalOddsSum = oddsList.reduce((sum, entry) => sum + (1 / entry.odds), 0);

            // 資金配分を計算して、払戻し金額が総資金よりも多くなるように調整
            oddsList.forEach(entry => {
                // 払戻し金額が総資金を上回るようにするために、余裕を持って設定
                const targetPayout = totalAmount * 1.1; // 払戻しが総資金の110%以上
                const betAmount = Math.max(100, Math.ceil((targetPayout / entry.odds) / 100) * 100); // 100円単位
                const payoutAmount = Math.floor(betAmount * entry.odds); // 小数点以下を切り捨て

                const resultSpan = document.getElementById(`result${entry.horse}`);
                resultSpan.textContent = `Колья: ${betAmount} / Возврат: ${payoutAmount}`;
            });

            // 入力がないкольяとВозвратをリセット
            for (let i = 1; i <= maxHorses; i++) {
                if (!oddsList.some(entry => entry.horse === i)) {
                    document.getElementById(`result${i}`).textContent = "Колья: - / Возврат: -";
                }
            }
        }
    </script>
</body>
</html>
