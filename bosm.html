import streamlit as st
import random
import pandas as pd

def simulate(payout, win_rate, initial_funds, is_compound, bet_percentage, num_trials=100):
    funds = initial_funds
    results = []

    for i in range(1, num_trials + 1):
        bet_amount = funds * bet_percentage / 100 if is_compound else initial_funds * bet_percentage / 100
        bet_amount = min(bet_amount, funds)  # Avoid betting more than available funds
        
        if funds <= 0:
            results.append([i, "×", 0, funds])
            continue

        outcome = "◯" if random.random() < win_rate else "×"
        profit = bet_amount * (payout - 1) if outcome == "◯" else -bet_amount
        funds += profit

        results.append([i, outcome, round(profit, 2), round(funds, 2)])

    return results

# Streamlit app
st.title("ランダムシミュレーター")

# Input fields
payout = st.number_input("ペイアウト倍率", min_value=1.0, value=2.0, step=0.1)
win_rate = st.number_input("勝率 (0-1)", min_value=0.0, max_value=1.0, value=0.5, step=0.01)
initial_funds = st.number_input("初期資金", min_value=1.0, value=1000.0, step=1.0)
is_compound = st.checkbox("複利運用")
bet_percentage = st.number_input("ベット金額 (固定 or 初期資金の％)", min_value=1.0, value=10.0, step=1.0)
num_trials = st.number_input("試行回数", min_value=1, value=100, step=1)

if st.button("シミュレーション開始"):
    results = simulate(payout, win_rate, initial_funds, is_compound, bet_percentage, num_trials)
    df = pd.DataFrame(results, columns=["回数", "勝敗", "損益", "合計資金"])

    st.subheader("結果")
    st.dataframe(df)

    st.line_chart(df["合計資金"].astype(float))
